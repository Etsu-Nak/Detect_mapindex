# 外邦図の地図記号の検出用プログラム
GiSデータ化した外邦図の地図記号のうち、植生記号13種類、水域、住宅地を検出し、GISデータとして使用するためのプログラムです。    
YOLOv8を使用していますので、インストールは必須です。    
植生記号は、検出された範囲の中点をポイントとし、その属性テーブルにクラスとして植生の種類が書かれているポイントベクターデータとして作成されます。水域と住宅地は、それぞれの範囲がポリゴンベクターデータとして作成されます。    
それぞれ、最終生成物はGISデータ化した地図上に重ねることができます。
こちらには、ファインチューニングしたYOLOv8のプログラムも置いてありますが、植生記号検出ではトレーニングデータ120、バリデーションデータ51、住宅地と水域はトレーニングデータ320、バリデーションデータ80、で、再学習しています。
GISデータ化していれば、外邦図の一部を切り取った状態でも処理は可能ですが、基本的に、最初に指定したフォルダ内に入っているGeotiff画像の全てを処理します。

## Making_point_mark_all_rename_final-E.ipynb
GISデータ化した外邦図をインプットし、植生記号検出ポイントデータ(v_がファイル名の頭についている）を作成します。同時に、寺・神社・墓を検出したポイントデータ(o_がファイル名の頭についている）も別途作成します。    
植生記号の種類は、ポイントベクターデータの属性テーブルに数字で記されており、    
0：針葉樹林、1：広葉樹林、2：荒地（草地）、3：竹林、4：桑畑、5：水田、6：枯死木林、9：乾田、10：ハイマツ、11：針葉樹単木、13：みつまた、14：茶の木、15：棕櫚　にそれぞれ対応しています。    
なお、もう一つ同時に作成されるポイントベクターデータには
7：寺院、8：神社、12：墓、が、属性テーブルに記されています。
使用するモデルは
best_v.ptです。Releaseよりダウンロード可能です。

## for_segmentation_final_class_resid_dj.ipynb
GISデータ化した外邦図をインプットし、住宅地をポリゴンベクターとして検出します。    
ただし、元々の地図上で住居を黒い矩形で表す際、その面積が本来の建物の面積を正確に示しているわけではないことと、地図の作成者によって、住宅地の範囲の線引きに差があることから、現在の地図との単純な面積比較には使えないと思います。    
## for_segmentation_final_class_water.ipynb
GISデータ化した外邦図をインプットし、水域をポリゴンベクターとして検出します。   
class_0が湿地帯、class_1が水域に対応していますが、湿地帯については、精度検証が終わっていません。    
水域については、全く水域の無い等高線の建て込んだ箇所を、水域の疑似等高線と誤判読するケースが多発しますので、そういった箇所を手で消去する修正が必要となります。    
また、細い川や水路については、途中で検出されないこともあります。    
ただし、ため池などの比較的小さな水域については、高精度で検出可能です。


